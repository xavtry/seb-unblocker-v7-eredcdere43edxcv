<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seb's Unblocker V7</title>
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/waves.css">
</head>
<body>

<!-- Waves -->
<div class="wave"></div>
<div class="wave"></div>
<div class="wave"></div>

<!-- Tab Bar -->
<div id="tabBar">
  <button id="newTabBtn">+</button>
</div>

<!-- Container for Tabs -->
<div class="container" id="tabContainer"></div>

<script src="js/tabs.js"></script>
<script src="js/search.js"></script>
<script src="js/iframeHandler.js"></script>

<script>
let tabCount = 0;
const tabBar = document.getElementById('tabBar');
const tabContainer = document.getElementById('tabContainer');

function createHomeTab() {
  tabCount++;
  const tabId = 'tab' + tabCount;

  // Tab button
  const tabButton = document.createElement('div');
  tabButton.classList.add('tab', 'active');
  tabButton.id = tabId + '-btn';
  tabButton.innerText = "Home";
  tabButton.addEventListener('click', ()=>activateTab(tabId));
  
  const closeBtn = document.createElement('button');
  closeBtn.classList.add('closeTab');
  closeBtn.innerText = 'x';
  closeBtn.onclick = (e)=>{ e.stopPropagation(); closeTab(tabId); }
  tabButton.appendChild(closeBtn);
  
  tabBar.insertBefore(tabButton, document.getElementById('newTabBtn'));

  // Tab content
  const tabContent = document.createElement('div');
  tabContent.classList.add('tabContent','active');
  tabContent.id = tabId;

  tabContent.innerHTML = `
    <h1 class="glow-text" style="text-align:center; margin-top:20px;">
      Seb's Unblocker<sup>V7</sup>
    </h1>
    <div class="search-container">
      <input type="text" placeholder="Enter website URL..." class="urlInput">
      <button class="goBtn">Go</button>
    </div>
  `;
  tabContainer.appendChild(tabContent);

  const goBtn = tabContent.querySelector('.goBtn');
  const urlInput = tabContent.querySelector('.urlInput');
  goBtn.addEventListener('click', ()=> {
    let url = urlInput.value.trim();
    if(!url) return;
    if(!/^https?:\/\//i.test(url)) url = 'https://' + url;
    createWebTab(url);
  });
  urlInput.addEventListener('keypress', e => { if(e.key==='Enter') goBtn.click(); });

  activateTab(tabId);
}

function createWebTab(url) {
  tabCount++;
  const tabId = 'tab' + tabCount;

  const tabButton = document.createElement('div');
  tabButton.classList.add('tab', 'active');
  tabButton.id = tabId + '-btn';
  tabButton.innerText = url;
  tabButton.addEventListener('click', ()=>activateTab(tabId));
  
  const closeBtn = document.createElement('button');
  closeBtn.classList.add('closeTab');
  closeBtn.innerText = 'x';
  closeBtn.onclick = (e)=>{ e.stopPropagation(); closeTab(tabId); }
  tabButton.appendChild(closeBtn);

  tabBar.insertBefore(tabButton, document.getElementById('newTabBtn'));

  const tabContent = document.createElement('div');
  tabContent.classList.add('tabContent','active');
  tabContent.id = tabId;

  // Use proxy endpoint
  tabContent.innerHTML = `<iframe src="/proxy?url=${encodeURIComponent(url)}"></iframe>`;

  tabContainer.appendChild(tabContent);
  activateTab(tabId);
}

function activateTab(tabId) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tabContent').forEach(tc=>tc.classList.remove('active'));
  document.getElementById(tabId + '-btn').classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

function closeTab(tabId) {
  const btn = document.getElementById(tabId + '-btn');
  const content = document.getElementById(tabId);
  if(btn) btn.remove();
  if(content) content.remove();

  const tabs = document.querySelectorAll('.tab');
  if(tabs.length>0) {
    const lastTabId = tabs[tabs.length-1].id.replace('-btn','');
    activateTab(lastTabId);
  }
}

document.getElementById('newTabBtn').addEventListener('click', createHomeTab);

// Initialize first home tab
createHomeTab();
</script>

</body>
</html>

